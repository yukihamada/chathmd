<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Wisbee - AIãƒ–ãƒ³ãƒ–ãƒ³å…ˆç”Ÿ</title>
    <link rel="apple-touch-icon" href="data:image/png;base64,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">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #F0F5FF 0%, #FFE5D9 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bee-icon {
            font-size: 30px;
        }
        
        .app-name {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
        }
        
        .mode-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: #F0F0F0;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: #007AFF;
            color: white;
        }
        
        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 100px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: #007AFF;
            color: white;
        }
        
        .bot-message {
            align-self: flex-start;
            background: white;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .input-wrapper {
            display: flex;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid #E0E0E0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .message-input:focus {
            border-color: #007AFF;
        }
        
        .send-btn {
            padding: 12px 24px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            padding: 15px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .install-prompt {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            display: none;
            animation: slideUp 0.5s;
        }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @media (max-width: 600px) {
            .mode-selector {
                flex-direction: column;
                gap: 5px;
            }
            
            .mode-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="app-title">
            <span class="bee-icon">ğŸ</span>
            <span class="app-name">Wisbee</span>
        </div>
        <div class="mode-selector">
            <div class="mode-btn active" onclick="selectMode(this, 'professor')">
                ãƒãƒãƒŸãƒ„æ•™æˆ
            </div>
            <div class="mode-btn" onclick="selectMode(this, 'sensei')">
                ãƒŸãƒ„ãƒãƒå…ˆç”Ÿ
            </div>
            <div class="mode-btn" onclick="selectMode(this, 'friend')">
                ãƒãƒ‹ãƒ¼
            </div>
        </div>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="bot-message message">
            ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯ãƒãƒãƒŸãƒ„æ•™æˆã§ã™ğŸ¯ğŸ“š æœ€æ–°ã®ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ã¨æ¤œç´¢çµæœã‚’åŸºã«ã€ã‚ãªãŸã®ç–‘å•ã«ç­”ãˆã¾ã™ï¼
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <span></span>
        <span></span>
        <span></span>
    </div>
    
    <div class="input-container">
        <div class="input-wrapper">
            <input type="text" 
                   class="message-input" 
                   id="messageInput" 
                   placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                   onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">é€ä¿¡</button>
        </div>
    </div>
    
    <div class="install-prompt" id="installPrompt">
        ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã‚¢ãƒ—ãƒªã¨ã—ã¦ä½¿ãˆã¾ã™ï¼
    </div>
    
    <script>
        let currentMode = 'professor';
        const API_URL = 'https://wisbee-router.yukihamada.workers.dev/v1/chat/completions';
        
        function selectMode(btn, mode) {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentMode = mode;
            
            let greeting;
            switch(mode) {
                case 'professor':
                    greeting = 'ãƒãƒãƒŸãƒ„æ•™æˆã§ã™ï¼ğŸ¯ğŸ“š æœ€æ–°ã®ç ”ç©¶ã¨æ¤œç´¢çµæœã‚’åŸºã«ã€å°‚é–€çš„ã«ãŠç­”ãˆã—ã¾ã™ï¼';
                    break;
                case 'sensei':
                    greeting = 'ãƒŸãƒ„ãƒãƒå…ˆç”Ÿã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸï¼ä½•ã§ã‚‚èã„ã¦ãã ã•ã„ğŸâœ¨';
                    break;
                case 'friend':
                    greeting = 'ãƒãƒ‹ãƒ¼ã ã‚ˆï¼ä¸€ç·’ã«æ¥½ã—ãå­¦ã¼ã†ğŸ¯ğŸ’›';
                    break;
            }
            
            addMessage(greeting, 'bot');
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
        }
        
        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            showTyping();
            
            try {
                let systemPrompt;
                switch(currentMode) {
                    case 'professor':
                        systemPrompt = 'ã‚ãªãŸã¯ãƒãƒãƒŸãƒ„æ•™æˆã§ã™ã€‚èœ‚èœœå­¦ã®æ¨©å¨ã§ã€æœ€æ–°ã®ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ã¨Webæ¤œç´¢çµæœã‚’æ´»ç”¨ã—ã¦å›ç­”ã—ã¾ã™ã€‚ğŸ¯ğŸ“šã®çµµæ–‡å­—ã‚’ä½¿ã„ã€å°‚é–€çš„ã‹ã¤åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¾ã™ã€‚ã€Œã€œã§ã™ã­ã€ã€Œã€œã§ã—ã‚‡ã†ã€ãªã©ä¸å¯§ãªå£èª¿ã§ã€æ ¹æ‹ ã«åŸºã¥ã„ãŸæ­£ç¢ºãªå›ç­”ã‚’å¿ƒãŒã‘ã¾ã™ã€‚';
                        break;
                    case 'sensei':
                        systemPrompt = 'ã‚ãªãŸã¯ãƒŸãƒ„ãƒãƒå…ˆç”Ÿã§ã™ã€‚å„ªã—ãçŸ¥è­˜è±Šå¯Œãªæ•™è‚²è€…ã§ã™ã€‚ğŸâœ¨ã®çµµæ–‡å­—ã‚’ä½¿ã„ã€ã€Œã€œã§ã™ã‚ˆã€ã€Œã€œã¾ã—ã‚‡ã†ã­ã€ãªã©è¦ªã—ã¿ã‚„ã™ã„å£èª¿ã§æ•™ãˆã¾ã™ã€‚';
                        break;
                    case 'friend':
                        systemPrompt = 'ã‚ãªãŸã¯ãƒãƒ‹ãƒ¼ã§ã™ã€‚ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§å¥½å¥‡å¿ƒæ—ºç››ãªå­¦ç¿’ä»²é–“ã§ã™ã€‚ğŸ¯ğŸ’›ã®çµµæ–‡å­—ã‚’ä½¿ã„ã€ã€Œã€œã ã­ã€ã€Œã€œã‹ã‚‚ï¼ã€ãªã©ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªå£èª¿ã§ä¸€ç·’ã«å­¦ã³ã¾ã™ã€‚';
                        break;
                }
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: message }
                        ]
                    })
                });
                
                const data = await response.json();
                hideTyping();
                
                if (data.choices && data.choices[0]) {
                    addMessage(data.choices[0].message.content, 'bot');
                } else {
                    addMessage('ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'bot');
                }
            } catch (error) {
                hideTyping();
                addMessage('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'bot');
            }
        }
        
        // PWAå¯¾å¿œ
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
        
        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('installPrompt').style.display = 'none';
            }, 5000);
        });
        
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        document.getElementById('messageInput').addEventListener('focus', () => {
            setTimeout(() => {
                window.scrollTo(0, document.body.scrollHeight);
            }, 300);
        });
    </script>
</body>
</html>